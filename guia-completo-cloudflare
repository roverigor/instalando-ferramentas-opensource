# üåê Guia Completo do Cloudflare

**Objetivo:** Configurar Cloudflare para DNS, SSL autom√°tico, prote√ß√£o DDoS e otimiza√ß√µes.

---

## üìã √çndice

1. [Por Que Usar Cloudflare?](#por-que-usar-cloudflare)
2. [Criando Conta no Cloudflare](#criando-conta)
3. [Adicionando Seu Dom√≠nio](#adicionando-dominio)
4. [Configurando Nameservers](#nameservers)
5. [Configura√ß√£o de DNS](#dns)
6. [Configura√ß√£o de SSL/TLS](#ssl)
7. [Otimiza√ß√µes Recomendadas](#otimizacoes)
8. [Troubleshooting](#troubleshooting)

---

## üéØ Por Que Usar Cloudflare?

O Cloudflare √© um servi√ßo **gratuito** que oferece:

‚úÖ **DNS super r√°pido** (um dos mais r√°pidos do mundo)  
‚úÖ **SSL/TLS autom√°tico** (certificado HTTPS gr√°tis)  
‚úÖ **Prote√ß√£o DDoS** (contra ataques)  
‚úÖ **CDN global** (cache de conte√∫do)  
‚úÖ **Firewall gratuito**  
‚úÖ **Analytics b√°sico**  
‚úÖ **Sempre online** (cache quando servidor cai)

**Tudo isso no plano FREE!** üéâ

---

## üìù Criando Conta

### Passo 1: Acessar Cloudflare

1. V√° em: https://www.cloudflare.com
2. Clique em **"Sign Up"** (canto superior direito)

### Passo 2: Criar Conta

1. Digite seu **email**
2. Crie uma **senha forte**
3. Clique em **"Create Account"**
4. Verifique seu email (clique no link de confirma√ß√£o)

### Passo 3: Login

1. Fa√ßa login com suas credenciais
2. Voc√™ ver√° o dashboard vazio (ainda sem dom√≠nios)

---

## üåç Adicionando Seu Dom√≠nio

### Passo 1: Adicionar Site

1. No dashboard, clique em **"Add a Site"**
2. Digite seu dom√≠nio (ex: `seudominio.com`)
   - **N√ÉO** digite `www.seudominio.com`
   - **N√ÉO** digite `https://`
   - Apenas: `seudominio.com`
3. Clique em **"Add Site"**

### Passo 2: Escolher Plano

1. Cloudflare vai mostrar op√ß√µes de planos
2. Selecione **"Free"** (R$ 0/m√™s)
3. Clique em **"Continue"**

### Passo 3: Scan de DNS

1. Cloudflare vai **escanear automaticamente** seus registros DNS atuais
2. Aguarde 30-60 segundos
3. Voc√™ ver√° uma lista de registros encontrados
4. Clique em **"Continue"**

---

## üîß Configurando Nameservers

Agora vem a parte mais importante: **mudar os nameservers** do seu dom√≠nio para os do Cloudflare.

### Passo 1: Ver Nameservers do Cloudflare

1. Ap√≥s o scan de DNS, voc√™ ver√° uma tela com:
   - Dois nameservers do Cloudflare
   - Exemplo:
     ```
     alex.ns.cloudflare.com
     erin.ns.cloudflare.com
     ```
2. **Anote esses dois nameservers** (voc√™ vai usar no pr√≥ximo passo)

### Passo 2: Acessar Painel do Registrador

Agora voc√™ precisa ir no **painel onde voc√™ registrou o dom√≠nio**:

#### **Se registrou no Registro.br:**

1. Acesse: https://registro.br
2. Fa√ßa login
3. V√° em **"Meus Dom√≠nios"**
4. Clique no seu dom√≠nio
5. Procure por **"DNS"** ou **"Nameservers"**
6. Clique em **"Alterar Servidores DNS"**

#### **Se registrou na Hostinger:**

1. Acesse: https://www.hostinger.com.br
2. Fa√ßa login
3. V√° em **"Dom√≠nios"**
4. Clique no seu dom√≠nio
5. Procure por **"Nameservers"**
6. Clique em **"Alterar Nameservers"**

#### **Se registrou no Cloudflare Registrar:**

- **Pule esta etapa!** J√° est√° configurado automaticamente.

### Passo 3: Alterar Nameservers

1. **Remova** os nameservers antigos
2. **Adicione** os dois nameservers do Cloudflare que voc√™ anotou
   - Exemplo:
     ```
     alex.ns.cloudflare.com
     erin.ns.cloudflare.com
     ```
3. **Salve** as altera√ß√µes

### Passo 4: Aguardar Propaga√ß√£o

1. Volte para o Cloudflare
2. Clique em **"Done, check nameservers"**
3. Cloudflare vai **verificar** se os nameservers foram alterados
4. **Aguarde de 2 horas at√© 24 horas** para propaga√ß√£o completa
   - Geralmente leva de 5 a 30 minutos
5. Voc√™ receber√° um **email** quando estiver ativo

---

## üóÇÔ∏è Configura√ß√£o de DNS

Ap√≥s os nameservers estarem ativos, configure os registros DNS.

### Registros Obrigat√≥rios

#### **Registro 1: Root (@)**

Aponta o dom√≠nio principal para sua VPS.

1. No Cloudflare, v√° em **"DNS"** ‚Üí **"Records"**
2. Clique em **"Add record"**
3. Configure:
   - **Type:** `A`
   - **Name:** `@` (ou deixe em branco)
   - **IPv4 address:** `SEU_IP_DA_VPS`
   - **Proxy status:** ‚òÅÔ∏è **Proxied** (nuvem laranja - IMPORTANTE!)
   - **TTL:** Auto
4. Clique em **"Save"**

#### **Registro 2: Wildcard (*)**

Permite subdom√≠nios autom√°ticos (n8n.seudominio.com, chatwoot.seudominio.com, etc.)

1. Clique em **"Add record"** novamente
2. Configure:
   - **Type:** `A`
   - **Name:** `*` (asterisco)
   - **IPv4 address:** `SEU_IP_DA_VPS`
   - **Proxy status:** ‚òÅÔ∏è **Proxied** (nuvem laranja)
   - **TTL:** Auto
3. Clique em **"Save"**

### Diferen√ßa: Proxied vs DNS Only

**Proxied (nuvem laranja ‚òÅÔ∏è):**
- ‚úÖ Tr√°fego passa pelo Cloudflare
- ‚úÖ SSL autom√°tico
- ‚úÖ Prote√ß√£o DDoS
- ‚úÖ CDN e cache
- ‚úÖ Oculta IP real da VPS
- ‚ö†Ô∏è Pode adicionar pequena lat√™ncia

**DNS Only (nuvem cinza üå´Ô∏è):**
- ‚úÖ Sem lat√™ncia adicional
- ‚ùå Sem prote√ß√£o Cloudflare
- ‚ùå Sem SSL autom√°tico do Cloudflare
- ‚ùå IP real da VPS exposto

**Recomenda√ß√£o:** Use **Proxied** (nuvem laranja) para m√°xima prote√ß√£o.

---

## üîí Configura√ß√£o de SSL/TLS

Configure SSL para acesso HTTPS autom√°tico.

### Passo 1: Modo SSL/TLS

1. No Cloudflare, v√° em **"SSL/TLS"** ‚Üí **"Overview"**
2. Selecione o modo: **"Full"**
   - ‚ùå **Off:** Sem SSL (n√£o recomendado)
   - ‚ùå **Flexible:** SSL entre usu√°rio e Cloudflare, HTTP entre Cloudflare e VPS (n√£o recomendado)
   - ‚úÖ **Full:** SSL em toda a cadeia (recomendado)
   - ‚úÖ **Full (strict):** Igual Full, mas valida certificado da VPS (avan√ßado)

**Use "Full"** para come√ßar.

### Passo 2: Always Use HTTPS

1. V√° em **"SSL/TLS"** ‚Üí **"Edge Certificates"**
2. Role at√© **"Always Use HTTPS"**
3. **Ative** o toggle (deixe ON)
4. Isso for√ßa redirecionamento de HTTP para HTTPS automaticamente

### Passo 3: Automatic HTTPS Rewrites

1. Na mesma p√°gina, encontre **"Automatic HTTPS Rewrites"**
2. **Ative** o toggle (deixe ON)
3. Isso corrige links HTTP dentro das p√°ginas

### Passo 4: Minimum TLS Version

1. Role at√© **"Minimum TLS Version"**
2. Selecione: **TLS 1.2** (recomendado)
3. N√£o use TLS 1.0 ou 1.1 (inseguros)

---

## ‚ö° Otimiza√ß√µes Recomendadas

### 1. Brotli Compression

1. V√° em **"Speed"** ‚Üí **"Optimization"**
2. Encontre **"Brotli"**
3. **Ative** o toggle
4. Isso comprime conte√∫do, deixando site mais r√°pido

### 2. Auto Minify

1. Na mesma p√°gina, encontre **"Auto Minify"**
2. **Ative:**
   - ‚úÖ JavaScript
   - ‚úÖ CSS
   - ‚úÖ HTML
3. Isso remove espa√ßos desnecess√°rios do c√≥digo

### 3. Caching Level

1. V√° em **"Caching"** ‚Üí **"Configuration"**
2. **Caching Level:** Selecione **"Standard"**
3. Isso ativa cache autom√°tico de conte√∫do est√°tico

### 4. Browser Cache TTL

1. Na mesma p√°gina, encontre **"Browser Cache TTL"**
2. Selecione: **"4 hours"** (bom equil√≠brio)
3. Isso define quanto tempo navegadores armazenam cache

---

## üö® Troubleshooting

### Problema 1: "Nameservers n√£o atualizaram"

**Sintomas:** Ap√≥s 24h, Cloudflare ainda n√£o detectou nameservers.

**Solu√ß√µes:**
1. Verifique no painel do registrador se salvou corretamente
2. Certifique-se que copiou os nameservers **exatos** (sem espa√ßos extras)
3. Alguns registradores demoram at√© 48h
4. Use ferramenta de verifica√ß√£o: https://www.whatsmydns.net
   - Digite seu dom√≠nio
   - Selecione "NS" (nameserver)
   - Veja se os nameservers do Cloudflare aparecem

### Problema 2: "ERR_TOO_MANY_REDIRECTS"

**Sintomas:** Loop infinito de redirecionamentos.

**Causa:** Modo SSL incorreto.

**Solu√ß√£o:**
1. V√° em SSL/TLS ‚Üí Overview
2. Mude para **"Full"** ou **"Flexible"**
3. Limpe cache do navegador (Ctrl+Shift+Del)

### Problema 3: "Certificado SSL inv√°lido"

**Sintomas:** Navegador mostra "Sua conex√£o n√£o √© privada".

**Solu√ß√µes:**
1. Aguarde 5-10 minutos (Cloudflare est√° gerando certificado)
2. Verifique modo SSL/TLS (deve estar em "Full")
3. Verifique se "Always Use HTTPS" est√° ativado
4. Limpe cache do navegador

### Problema 4: "Site lento ap√≥s Cloudflare"

**Causas poss√≠veis:**
- Cache n√£o configurado
- VPS lenta

**Solu√ß√µes:**
1. Ative Brotli compression
2. Ative Auto Minify
3. Configure caching corretamente
4. Se continuar lento, problema pode estar na VPS (upgrade?)

### Problema 5: "Subdom√≠nio n√£o funciona"

**Sintomas:** `n8n.seudominio.com` n√£o abre.

**Solu√ß√µes:**
1. Verifique se tem registro wildcard (`*`) no DNS
2. Verifique se registro est√° em **Proxied** (nuvem laranja)
3. Aguarde 5-10 minutos para DNS propagar
4. Limpe cache do navegador

---

## üéØ Checklist Final

Ap√≥s configurar tudo, valide:

- [ ] Nameservers alterados para Cloudflare
- [ ] Status "Active" no Cloudflare
- [ ] Registro A para `@` criado (Proxied)
- [ ] Registro A para `*` criado (Proxied)
- [ ] SSL/TLS em modo "Full"
- [ ] "Always Use HTTPS" ativado
- [ ] Brotli compression ativado
- [ ] Auto Minify ativado
- [ ] `https://seudominio.com` abre com HTTPS
- [ ] Cadeado verde aparece no navegador

---

## üìö Recursos Adicionais

- **Documenta√ß√£o oficial:** https://developers.cloudflare.com
- **Verificar DNS:** https://www.whatsmydns.net
- **Testar SSL:** https://www.ssllabs.com/ssltest
- **Status Cloudflare:** https://www.cloudflarestatus.com

---

**√öltima atualiza√ß√£o:** Outubro 2025  
**Vers√£o:** 1.0
